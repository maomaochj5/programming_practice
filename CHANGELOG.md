# 更新日志 (Changelog)

本文档记录了智能超市收银系统的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [2.0.0] - (今天的日期) - 稳定性与体验重构

这是一个重大的版本更新，专注于从一个不稳定的原型重构为一个功能稳定、高性能且用户体验良好的应用程序。

### 修复 (Fixed)
- **启动崩溃**: 解决了因 `MainWindow` 同时继承 `QMainWindow` 和 `Ui::MainWindow` 导致的多重继承问题，通过改为组合模式 (`std::unique_ptr<Ui::MainWindow>`) 修复了启动时的段错误。
- **退出崩溃**: 修复了因手动 `delete` 由Qt父子系统管理的 `QObject` (`m_currentSale`) 导致的双重释放问题，通过使用 `deleteLater()` 解决。
- **核心逻辑错误**: 修正了商品“编辑”和“删除”功能错误地作用于购物车视图而非主商品列表的逻辑。
- **结算信息不更新**: 重构了 `Sale` 类中的信号发射逻辑，确保在添加/删除商品或应用折扣后，总计金额能被可靠地更新。
- **UI样式混乱**: 彻底移除了所有零散、硬编码的 `setStyleSheet`，并在主窗口中实现了一个唯一的、全局的、高对比度的样式表，解决了所有“白底白字”和“黑底黑字”的视觉问题。
- **日期显示丢失**: 为主窗口添加了 `QTimer`，以确保系统时间能够实时更新并显示。

### 改进 (Changed)
- **异步数据库架构**: 使用 `QtConcurrent::run` 将所有数据库操作移至后台线程，彻底解决了UI在数据读写时冻结的问题。整个应用程序的更新流程被重构为完全由信号和槽驱动。
- **交互式购物车**: 通过自定义 `QStyledItemDelegate`，为购物车表格的每一行都添加了内联的 `QSpinBox` (修改数量) 和“移除”按钮，极大地提升了操作效率。
- **统一的搜索功能**: 将条码搜索（回车）和名称搜索（按钮）统一到一个 `onSearchOrScan` 槽函数中，通过启发式方法自动判断输入类型。
- **关注点分离**: 将商品管理功能（添加、编辑、删除）从主窗口剥离，封装到一个新的 `ProductManagementDialog` 对话框中，使主界面更专注于销售任务。
- **AI推荐和支付界面优化**: 将AI推荐从纯文本列表升级为带有图片和按钮的水平滚动商品轮播。支付对话框也从单选按钮升级为更直观的图标大按钮。

## [未发布]

### 新增
- 商品双击添加到购物车功能
- 完整的自动化GUI测试套件
- 详细的项目文档和贡献指南

### 修复
- 解决GUI按钮状态显示问题
- 修复数据库约束冲突问题
- 优化内存管理和智能指针使用

### 改进
- 增强了测试覆盖率(单元测试、集成测试、GUI测试)
- 完善了错误处理和用户反馈
- 优化了代码结构和注释

## [1.0.0] - 2025-07-15

### 新增
- 🎉 初始版本发布
- ✨ 完整的商品管理系统
  - 商品添加、编辑、删除
  - 条码管理
  - 库存跟踪
  - 分类管理
- 💰 销售和收银功能
  - 新建销售
  - 商品扫描添加
  - 数量调整
  - 支付处理
  - 购物车管理
- 📷 智能条码识别
  - 摄像头实时扫描
  - 手动条码输入
  - 自动商品识别
- 🤖 AI智能推荐系统
  - 基于购物车内容推荐
  - 机器学习算法
  - 个性化推荐
- 💾 数据持久化
  - SQLite数据库
  - 完整的数据模型
  - 事务处理
- 🎨 现代化用户界面
  - Qt Widgets界面
  - 响应式布局
  - 直观的操作流程
- 🏗️ 模块化架构
  - MVC设计模式
  - 清晰的代码结构
  - 松耦合设计
- 🧪 完整测试套件
  - 单元测试
  - 集成测试
  - GUI自动化测试

### 技术栈
- **前端**: Qt 6.x Widgets
- **后端**: C++17
- **数据库**: SQLite
- **构建**: CMake
- **测试**: QTest Framework

### 核心模块
- **UI层**: MainWindow, ProductDialog, PaymentDialog
- **业务逻辑层**: ProductManager, CheckoutController
- **数据访问层**: DatabaseManager
- **AI服务层**: AIRecommender
- **硬件集成层**: BarcodeScanner, ReceiptPrinter
- **数据模型**: Product, Customer, Sale, SaleItem

### 已知问题
- 条码扫描功能需要摄像头支持
- AI推荐需要足够的历史数据训练
- 某些平台可能需要额外的Qt插件

### 系统要求
- Qt 6.2+
- CMake 3.16+
- C++17兼容编译器
- SQLite 3.x

---

## 版本说明

### 版本命名规则
- **主版本号**: 重大功能更新或架构变更
- **次版本号**: 新功能添加
- **修订号**: Bug修复和小幅改进

### 变更类型
- **新增** - 新功能
- **修改** - 对现有功能的变更
- **弃用** - 即将移除的功能
- **移除** - 已移除的功能
- **修复** - Bug修复
- **安全** - 安全性修复

### 发布周期
- **主版本**: 按需发布，重大更新
- **次版本**: 每月发布，新功能
- **修订版本**: 每两周发布，Bug修复

---

## 贡献者

感谢所有为项目做出贡献的开发者:

### v1.0.0 开发团队
- **项目架构师**: 负责整体架构设计
- **UI开发工程师**: 负责用户界面开发
- **后端开发工程师**: 负责业务逻辑实现
- **测试工程师**: 负责测试用例编写

---

## 反馈和支持

如果您在使用过程中遇到问题或有建议，请:

1. 查看 [FAQ](docs/FAQ.md)
2. 搜索现有的 [Issues](https://github.com/your-repo/issues)
3. 创建新的 Issue 描述问题
4. 发送邮件至: support@yourproject.com

---

*最后更新: 2025-07-15*
