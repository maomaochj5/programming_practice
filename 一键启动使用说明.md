# SmartPOS 一键启动脚本使用说明

## 概述

这两个Python脚本提供了SmartPOS智能收银系统的一键启动和停止功能：

- `start_system.py` - 一键启动整个系统
- `stop_system.py` - 一键停止所有服务

## 系统要求

### 必需组件
- Python 3.7 或更高版本
- CMake
- Make 或 Ninja 构建工具
- 所有Python依赖（自动安装）

### 支持的操作系统
- macOS
- Linux
- Windows（部分功能）

## 使用方法

### 启动系统

```bash
# 方法1: 直接运行Python脚本
python3 start_system.py

# 方法2: 如果有执行权限，可以直接运行
./start_system.py
```

### 停止系统

```bash
# 方法1: 使用Ctrl+C停止（推荐）
# 在启动脚本运行时按 Ctrl+C

# 方法2: 运行停止脚本
python3 stop_system.py
# 或
./stop_system.py
```

## 启动流程

启动脚本会按以下顺序执行：

1. **[1/5] 检查 Python 环境** - 验证Python版本
2. **[2/5] 安装 Python 依赖** - 自动安装AI模型所需的Python包
3. **[3/5] 启动 AI 推荐服务器** - 启动Flask API服务器（端口5001）
4. **[4/5] 检查构建环境** - 验证CMake和Make工具
5. **[5/5] 编译和启动应用程序** - 编译C++应用并启动GUI

## 功能特点

### 智能错误处理
- 自动检测缺失的依赖
- 提供详细的错误信息
- 生成日志文件便于调试

### 进程管理
- 自动保存进程ID到文件
- 优雅的进程停止机制
- 强制终止卡死的进程

### 日志记录
启动过程中会生成以下日志文件：
- `ai_server.log` - AI服务器运行日志
- `cmake.log` - CMake配置日志
- `make.log` - 编译过程日志

### 跨平台支持
- 自动检测操作系统
- 适配不同平台的命令
- Windows下禁用颜色输出

## 故障排除

### 常见问题

1. **Python依赖安装失败**
   - 确保有pip和网络连接
   - 手动运行：`pip3 install -r Ai_model/requirements.txt`

2. **CMake配置失败**
   - 检查CMake是否正确安装
   - 查看 `cmake.log` 了解详细错误

3. **编译失败**
   - 确保有C++编译器
   - 查看 `make.log` 了解编译错误

4. **AI服务器启动超时**
   - 检查端口5001是否被占用
   - 查看 `ai_server.log` 了解服务器错误

### 手动清理

如果脚本意外终止，可以手动清理：

```bash
# 停止所有相关进程
pkill -f "python.*api_server.py"
pkill -f "SmartPOS"

# 清理临时文件
rm -f .ai_server.pid .app.pid ai_server.log cmake.log make.log
```

## 服务信息

启动成功后：
- **AI推荐服务器**: http://127.0.0.1:5001
- **SmartPOS应用**: 桌面GUI应用程序

## 注意事项

1. 首次运行可能需要较长时间进行编译
2. 确保系统有足够的内存运行AI模型
3. 建议在稳定的网络环境下首次运行（需要下载依赖）
4. Windows用户可能需要额外配置构建环境

## 开发模式

如果需要调试，可以分别启动各组件：

```bash
# 只启动AI服务器
cd Ai_model && python3 api_server.py

# 只编译应用程序
cd build && make && ./SmartPOS
``` 